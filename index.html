<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Remote LED Button</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; padding: 24px; max-width: 600px; margin: auto; }
    .btn { font-size: 20px; padding: 14px 20px; border-radius: 12px; border: 0; cursor: pointer; }
    .on  { background: #e74c3c; color: white; }
    .off { background: #ddd; }
    .row { display: flex; gap: 12px; margin-top: 16px; }
    #status { margin-top: 10px; font-size: 14px; opacity: 0.8; }
    .card { padding: 16px; border: 1px solid #eee; border-radius: 12px; }
    code { background: #f6f8fa; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Remote LED Control</h1>
  <div class="card">
    <p>Press <strong>ON</strong> to light the LED; press <strong>OFF</strong> to turn it off.</p>
    <div class="row">
      <button id="btnOn"  class="btn on">LED ON</button>
      <button id="btnOff" class="btn off">LED OFF</button>
    </div>
    <div id="status">Connectingâ€¦</div>
  </div>

  <!-- Paho MQTT over WebSockets -->
  <script src="https://unpkg.com/paho-mqtt@1.1.0/paho-mqtt-min.js"></script>
  <script>
    // ===== CHANGE THESE THREE =====
    const TOPIC    = "tzuiyang/led/control"; // make it unique (your name helps)
    const HOST     = "test.mosquitto.org";   // public test broker
    const PORT     = 8081;                   // secure WebSocket port
    const PATH     = "/mqtt";                // WS path for Mosquitto
  
    const clientId = "web-" + Math.random().toString(16).slice(2);
    const client   = new Paho.MQTT.Client(HOST, PORT, PATH, clientId);
  
    function status(s){ document.getElementById("status").textContent = s; }
  
    client.onConnectionLost = (r)=> status("Disconnected: " + (r.errorMessage||""));
    client.onMessageArrived = (m)=> status("Broker echoed: " + m.payloadString);
  
    client.connect({
      useSSL: true,         // IMPORTANT on GitHub Pages
      timeout: 6,
      onSuccess: () => status("Connected to " + HOST + " (topic: " + TOPIC + ")"),
      onFailure: (e) => status("Connect failed: " + (e.errorMessage||""))
    });
  
    function publish(val){
      if(!client.isConnected()){ status("Not connected"); return; }
      const msg = new Paho.MQTT.Message(val);
      msg.destinationName = TOPIC;
      msg.retained = true;                 // so the ESP32 gets the latest state after reconnect
      client.send(msg);
      status("Sent: " + val);
    }
  
    // Hook up your buttons:
    // <button onclick="publish('1')">LED ON</button>
    // <button onclick="publish('0')">LED OFF</button>
  </script>

</body>
</html>
